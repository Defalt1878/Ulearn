Это краткий документ о том, как устроен фронт.

### Запуск и конфиги

#### Запуск

Имеется 2 типа сборки: development, production. У каждого типа свой конфиг webpack-а.

Сборки отличаются оптимизациями и использованием допольнительных утилит.

Все возможные варианты запуска проекта описаны в package.json в разделе scripts.

"start" -- запускает сборку dev типа,
добавляет webpack-dev-server для работы в браузере, подключается HMR.

"build" -- создает сборку типа prod в папке /build/,
использует все возможные оптимизации, минифицирование кода.
    
"analyze" произведет сборку в режиме prod с добавлением bundleAnalyzer,
который выведет в браузере информацию об используемых node_modules и размере бандла.
Используется для отслеживания размеров пакетов после [tree shaking](https://webpack.js.org/guides/tree-shaking/). 
С этой информацией можно понять что можно оптимизировать путем выделения отдельного
entry point, либо путем оптимизацией import-ов. 

"test" запуск jest тестов.

"storybook" запуск сторибука для разработки/тестирвоания.

#### configs

Конфиги webpack-а описаны в папке /config/ в файлах webpack.config.(dev||prod).
Имеется базовый конфиг webpack.config.base, в котором описаны alias-ы (они нужны, чтобы вместо @skbkontur/react-ui писать ui).
Так же в этой папке имеются утилиты: пути до нужных папок; поллифил; PWA плагины.

Настройки бабеля находятся в ./babel.config.cjs. Этот конфиг используется для webpack-а.

Настройки eslint-а находятся в ./eslintrc.cjs.
Он настроен на использование разных парсеров для ts и js файлов.
Для js он использует свой собственный babel конфиг.

tsconfig.json содержит все необходимое для компиляции ts файлов.

### Взаимодействие сервер-клиент

Имеется 2 проекта на бэке, от которых сильно зависит фронт: Api и Web. 

Api отвечает за работу базы данных, запросы на ручки и тд (имеет адрес http:[::]:8000, api.ulearn.me).

Web запускает скрипт build, берет полученную статичную сборку, и отдает её на запросы в браузере.
Также отвечает за рендер cshtml страниц (https:[::]:44300, http://localhost:53834/, ulearn.me).

У фронта же есть webpack-dev-server (http:[::]:3000).

Всю нужную информацию, авторизацию получаем от api.

### Как работает webpack-dev-server

В оперативную память кладется сборка, которая получается в скрипте "start".
Хоститься веб на [::]:3000, при любом запросе на этот адресс (localhost:3000, localhost:3000/123/123 и т.д.)
отдается index.html с бандлами скриптов.
Далее, если нужна легаси страница, запрос прокситься на web(localhost:44300).
А api запросы отправляются на localhost:8000.

Локално это прописано в src/proxyConfig.ts.

### Структура фронта

Входная точка - app.tsx (index.tsx рендерит эту компоненту и подключает serviceWorker)
в app.tsx мы также добавляем отловку ошибок в ErrorBoundary (сюда же можно отнести и 404 страницу :)).

Компоненты находятся в папках src/pages и src/components.
в pages обычно помещаются не сами компоненты, а их версия с подключением к redux (connect) или react-router-dom.

#### Redux и api

В App.js мы создаем redux хранилище, он состоит из мн-ва reducer-ов, их список можно посмотреть в src/redux/reducers. 
начальное состояние хранилища (дефолтные данные) описаны в разных файлах в папке src/redux
(например данные об аккаунте в redux/account, данные о курсах в redux/course).

Все api запросы описаны в api. Те запросы, что изменяют хранилище вынесены в redux export.

Actions описаны в src/actions.

#### Навигация

Для навигации мы используем react-router-dom, он сверяет адресную строку с паттернами/строками, описанными в router.ts
Рендерит наиболее подходящую компоненту, например для пути course/{courseId} отрендериться компонента course.

### Тесты
Тесты запускаются локально с помощью storybook + loki.
Для начала надо запустить сторибук, после чего запустить тесты loki.
```
yarn loki
```
loki/current эталонные скриншоты.

loki/difference не пройденные тесты.

yarn loki approve принять все изменения.

yarn loki test laptop тесты только на определенную платформу.

yarn loki update добавить скриншоты в эталон.

### Разные вспомогательные штуки  

Все константы находятся в src/consts.

Имеются вспомогательные функции (перевод в camelCase, склонение слова в зависимости от числа и тд) в src/utils.

в src/codeTranslator имеются функции, которые переводят текст katex и codeMirror.

## Доп информация

Мы подключаем полифилы с помощью babel.

Подключаем oldBrowser, которые просит обновить браузер, если он устарел, список поддерживаемых браузеров находиться в .browserlistrc.
